
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√©gories | Musk & Amber</title>
    <link rel="shortcut icon" type="image/x-icon" href="./WhatsApp_Image_2025-11-25_at_15.35.57-removebg-preview.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #3e1b2a;
            --secondary: #561e4b;
            --accent: #868d7d;
            --light: #f8f5f2;
            --dark: #2c2c2c;
            --gray: #95a5a6;
            --success: #27ae60;
        }

        body {
            background-color: #fefefe;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            background-color: var(--primary);
            color: white;
            padding: 10px 0;
        }

        .header-top-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-contact {
            font-size: 14px;
            margin-right: 20px;
        }

        .header-contact i {
            margin-right: 5px;
        }

        .header-social {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-social a {
            color: white;
            font-size: 14px;
        }

        .header-social a:hover {
            color: var(--accent);
        }

        /* Search Box Styles */
        .header-search {
            display: flex;
            align-items: center;
        }

        .search-container {
            position: relative;
        }

        .search-input {
            padding: 8px 15px 8px 35px;
            border: none;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            width: 200px;
            transition: width 0.3s;
        }

        .search-input:focus {
            width: 250px;
            outline: none;
            background-color: rgba(255, 255, 255, 0.3);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
        }

        .logo-container {
            text-align: center;
            padding: 20px 0;
            position: relative;
        }

        .logo-wrapper {
            display: inline-block;
            position: relative;
        }

        .logo-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            box-shadow: 0 5px 20px rgba(86, 30, 75, 0.3);
            border: 5px solid white;
            position: relative;
            z-index: 2;
        }

        .logo-img {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
        }
        
        .logo-container {
            padding: 15px 0;
            position: relative;
        }

        /* Logo Size Fix for Mobile - Made Larger */
        .logo-circle {
            width: 150px;
            height: 150px;
            margin-top: 10px;
        }

        .logo-img {
            width: 130px;
            height: 130px;
        }

        .logo-text {
            font-size: 32px; /* Increased font size for mobile */
            margin-top: 10px;
        }

        .logo-text {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            letter-spacing: 1px;
        }

        .logo-text span {
            color: var(--secondary);
        }

        /* Main Navigation */
        .main-nav {
            background-color: var(--light);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            position: relative;
        }

        /* Desktop Navigation */
        .desktop-nav {
            display: flex;
        }

        .desktop-nav ul {
            display: flex;
            list-style: none;
        }

        .desktop-nav ul li {
            position: relative;
        }

        .desktop-nav ul li a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 600;
            transition: all 0.3s;
            padding: 20px 25px;
            display: block;
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 0.5px;
        }

        .desktop-nav ul li a:hover {
            color: var(--secondary);
            background-color: rgba(86, 30, 75, 0.05);
        }

        .desktop-nav a.active {
            color: var(--secondary);
            background-color: rgba(86, 30, 75, 0.1);
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
        }

        .dropdown-content {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: white;
            min-width: 220px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 5px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 1000;
            padding: 10px 0;
        }

        .dropdown:hover .dropdown-content {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-content a {
            color: var(--dark);
            padding: 12px 20px;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            text-transform: none;
        }

        .dropdown-content a:hover {
            background-color: var(--light);
            color: var(--secondary);
            border-left: 3px solid var(--secondary);
        }

        .dropdown-content a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
        }

        .hamburger-menu {
            font-size: 24px;
            color: var(--dark);
            cursor: pointer;
            padding: 5px;
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 80%;
            max-width: 300px;
            height: 100vh;
            background-color: white;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
            z-index: 1000;
            padding: 70px 20px 20px;
        }

        .mobile-menu.active {
            left: 0;
        }

        .mobile-menu ul {
            list-style: none;
        }

        .mobile-menu ul li {
            margin-bottom: 10px;
        }

        .mobile-menu ul li a {
            text-decoration: none;
            color: var(--dark);
            font-size: 16px;
            font-weight: 500;
            display: block;
            padding: 12px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .mobile-menu ul li a:hover {
            background-color: var(--light);
            color: var(--secondary);
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .menu-overlay.active {
            display: block;
        }

        .close-menu {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: var(--dark);
            cursor: pointer;
        }

        .cart-icon {
            position: fixed;
            top: 200px;
            right: 20px;
            background-color: var(--secondary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(86, 30, 75, 0.3);
            z-index: 99;
            transition: transform 0.3s;
        }

        .cart-icon:hover {
            transform: scale(1.1);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background-color: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.active {
            right: 0;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .cart-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
        }

        .close-cart {
            font-size: 22px;
            color: var(--dark);
            cursor: pointer;
        }

        .cart-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .cart-items {
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            margin-right: 15px;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: var(--secondary);
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* Cart Size Selection */
        .cart-item-size {
            margin-bottom: 10px;
        }

        .size-options {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .size-option {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .size-option.selected {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            background-color: var(--light);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover {
            background-color: #ddd;
        }

        .cart-item-quantity {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .remove-item {
            color: var(--secondary);
            background: none;
            border: none;
            cursor: pointer;
            margin-left: auto;
        }

        .cart-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            background-color: #f9f9f9;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .checkout-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .checkout-btn:hover {
            background-color: var(--primary);
        }

        .empty-cart {
            text-align: center;
            padding: 40px 0;
            color: var(--gray);
        }

        .empty-cart i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }

        /* Categories Hero */
       .categories-hero {
            display: none; /* Hide the hero section */
        }
        
        /* Add margin to the products section since hero is removed */
        .products-section {
            padding-top: 40px !important;
        }
        
        /* Add a new categories display section */
        .categories-display {
            padding: 60px 0 40px;
            background-color: var(--light);
        }
        
        .categories-display-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .category-display-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
            text-align: center;
            position: relative;
            cursor: pointer;
        }
        
        .category-display-card:hover {
            transform: translateY(-5px);
        }
        
        .category-display-image {
            height: 180px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .category-display-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(62, 27, 42, 0.7) 0%, rgba(86, 30, 75, 0.5) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .category-display-card:hover .category-display-overlay {
            opacity: 1;
        }
        
        .category-display-link {
            color: white;
            text-decoration: none;
            font-weight: 600;
            padding: 10px 20px;
            background-color: var(--secondary);
            border-radius: 30px;
        }
        
        .category-display-content {
            padding: 20px;
        }
        
        .category-display-title {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .category-display-description {
            color: var(--gray);
            font-size: 14px;
        }

        .hero-content {
            position: relative;
            z-index: 3;
            width: 100%;
            text-align: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .categories-hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: white;
            line-height: 1.2;
        }

        .categories-hero p {
            font-size: 18px;
            margin-bottom: 30px;
            color: rgba(255, 255, 255, 0.9);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Category info banner */
        .category-info {
            background-color: var(--light);
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0 40px;
            text-align: center;
        }
        
        .category-info h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .category-info p {
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .clear-filter-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        
        .clear-filter-btn:hover {
            background-color: var(--primary);
        }

        /* Price Filter Section */
        .price-filter-section {
            padding: 60px 0 40px;
            background-color: var(--light);
        }

        .filter-title {
            text-align: center;
            margin-bottom: 40px;
            color: var(--primary);
            font-size: 36px;
            position: relative;
        }

        .filter-title::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 3px;
            background-color: var(--secondary);
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
        }

        .price-filter-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .price-range-container {
            margin-bottom: 30px;
        }

        .price-range-values {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--primary);
        }

        .price-range-slider {
            position: relative;
            height: 4px;
            background-color: #ddd;
            border-radius: 2px;
            margin-bottom: 20px;
        }

        .price-range-track {
            position: absolute;
            height: 100%;
            background-color: var(--secondary);
            border-radius: 2px;
        }

        .price-range-inputs {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 30px;
        }

        .price-input-group {
            flex: 1;
        }

        .price-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .price-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .price-input:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .price-filter-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .price-filter-btn {
            padding: 12px 25px;
            background-color: white;
            color: var(--dark);
            border: 2px solid var(--primary);
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .price-filter-btn:hover {
            background-color: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(86, 30, 75, 0.2);
        }

        .price-filter-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(86, 30, 75, 0.3);
        }

        .price-filter-btn.all-prices {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
            border-color: transparent;
        }

        .apply-filter-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: background-color 0.3s;
            margin-top: 20px;
        }

        .apply-filter-btn:hover {
            background-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(86, 30, 75, 0.3);
        }

        /* Products Section */
        .products-section {
            padding: 80px 0;
            background-color: white;
        }

        .section-title {
            text-align: center;
            margin-bottom: 60px;
            color: var(--primary);
            font-size: 36px;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 3px;
            background-color: var(--secondary);
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }

        .product-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .product-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--accent);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 2;
        }

        /* Type-specific badges */
        .product-badge.type-homme {
            background-color: #3498db;
        }

        .product-badge.type-femme {
            background-color: #e84393;
        }

        .product-badge.type-arabes {
            background-color: #f39c12;
        }

        .product-badge.type-niche {
            background-color: #9b59b6;
        }

        .product-image {
            height: 250px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .product-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .product-card:hover .product-overlay {
            opacity: 1;
        }

        .quick-view {
            background-color: white;
            color: var(--dark);
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-view:hover {
            background-color: var(--secondary);
            color: white;
        }

        .product-info {
            padding: 20px;
        }

        .product-category {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .product-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .product-price {
            font-size: 20px;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 15px;
        }

        .add-to-cart {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .add-to-cart:hover {
            background-color: var(--secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 70px;
            color: #e0e0e0;
            margin-bottom: 25px;
        }

        .empty-state h3 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 24px;
        }

        .empty-state p {
            color: var(--gray);
            max-width: 400px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        /* Newsletter */
        .newsletter {
            padding: 80px 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: white;
            text-align: center;
        }

        .newsletter h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        .newsletter p {
            font-size: 18px;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .newsletter-form {
            display: flex;
            max-width: 500px;
            margin: 0 auto;
        }

        .newsletter-input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 30px 0 0 30px;
            font-size: 16px;
            outline: none;
        }

        .newsletter-button {
            padding: 15px 30px;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 0 30px 30px 0;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .newsletter-button:hover {
            background-color: var(--accent);
        }

        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 60px 0 30px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            font-size: 20px;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 2px;
            background-color: var(--secondary);
            bottom: 0;
            left: 0;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
        }

        .footer-column ul li a {
            color: #bbb;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-column ul li a:hover {
            color: white;
        }

        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-icons a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            transition: background-color 0.3s;
        }

        .social-icons a:hover {
            background-color: var(--secondary);
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #bbb;
            font-size: 14px;
        }

        /* Checkout Form */
        .checkout-form-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1002;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .checkout-form-overlay.active {
            display: flex;
        }

        .checkout-form-container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .checkout-form-title {
            margin-bottom: 20px;
            color: var(--primary);
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .submit-order,
        .cancel-order {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-order {
            background-color: var(--secondary);
            color: white;
        }

        .submit-order:hover {
            background-color: var(--primary);
        }

        .cancel-order {
            background-color: #e74c3c;
            color: white;
        }

        .cancel-order:hover {
            background-color: #c0392b;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            animation: slideIn 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: #e74c3c;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .dropdown-content {
                position: static;
                opacity: 1;
                visibility: visible;
                transform: none;
                box-shadow: none;
                padding-left: 20px;
                display: none;
            }
            
            .dropdown.active .dropdown-content {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .header-top {
                padding: 10px 0;
            }

            .header-top-content {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .header-contact {
                text-align: center;
                margin-right: 0;
                margin-bottom: 5px;
            }

            .header-social {
                justify-content: center;
                margin-bottom: 10px;
            }

            .search-container {
                width: 100%;
                margin-top: 10px;
            }

            .search-input {
                width: 100%;
            }

            .logo-container {
                padding: 15px 0;
                position: relative;
            }

            .logo-circle {
                width: 100px;
                height: 100px;
            }

            .logo-img {
                width: 100px;
                height: 100px;
            }

            .logo-text {
                font-size: 24px;
            }

            .desktop-nav {
                display: none;
            }
            .logo-circle {
                width: 150px;
                height: 150px;
                margin-top: 10px;
            }

            .logo-img {
                width: 150px;
                height: 150px;
            }

            .logo-text {
                font-size: 32px; /* Increased font size for mobile */
                margin-top: 10px;
            }


            .mobile-nav {
                display: block;
                position: absolute;
                top: 20px;
                left: 20px;
                transform: none;
                z-index: 100;
            }

            .mobile-nav .hamburger-menu {
                font-size: 28px;
                color: var(--primary);
                background-color: var(--light);
                padding: 10px;
                border-radius: 5px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

            .cart-icon {
                position: fixed;
                top: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
                font-size: 20px;
                z-index: 101;
            }

            .cart-count {
                width: 20px;
                height: 20px;
                font-size: 11px;
            }

            .main-nav {
                display: none;
            }

            .categories-hero {
                height: auto;
                min-height: 300px;
                margin-top: 20px;
            }

            .categories-hero h1 {
                font-size: 32px;
            }

            .categories-hero p {
                font-size: 16px;
            }

            .filter-title,
            .section-title {
                font-size: 30px;
            }

            .price-filter-buttons {
                justify-content: center;
                gap: 10px;
            }

            .price-filter-btn {
                padding: 12px 20px;
                font-size: 14px;
            }

            .price-range-inputs {
                flex-direction: column;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
            }

            .newsletter-form {
                flex-direction: column;
            }

            .newsletter-input {
                border-radius: 30px;
                margin-bottom: 10px;
            }

            .newsletter-button {
                border-radius: 30px;
            }
            
            /* Mobile Menu Styles */
            .mobile-menu {
                position: fixed;
                top: 0;
                left: -100%;
                width: 80%;
                max-width: 300px;
                height: 100vh;
                background-color: white;
                box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
                transition: left 0.3s ease;
                z-index: 1000;
                padding: 70px 20px 20px;
            }

            .mobile-menu.active {
                left: 0;
            }

            .mobile-menu ul {
                list-style: none;
            }

            .mobile-menu ul li {
                margin-bottom: 10px;
            }

            .mobile-menu ul li a {
                text-decoration: none;
                color: var(--dark);
                font-size: 16px;
                font-weight: 500;
                display: block;
                padding: 12px;
                border-radius: 4px;
                transition: background-color 0.3s;
            }

            .mobile-menu ul li a:hover {
                background-color: var(--light);
                color: var(--secondary);
            }

            .menu-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
            }

            .menu-overlay.active {
                display: block;
            }

            .close-menu {
                position: absolute;
                top: 20px;
                right: 20px;
                font-size: 24px;
                color: var(--dark);
                cursor: pointer;
                z-index: 1001;
            }

            .form-buttons {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .logo-text {
                font-size: 20px;
            }

            .categories-hero h1 {
                font-size: 26px;
            }

            .price-filter-buttons {
                flex-direction: column;
                align-items: center;
            }

            .price-filter-btn {
                width: 80%;
                justify-content: center;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }
        }
         .product-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .product-modal-overlay.active {
            display: flex;
        }

        .product-modal {
            background-color: white;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--dark);
            cursor: pointer;
            z-index: 10;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background-color: var(--secondary);
            color: white;
        }

        .modal-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .modal-content {
                grid-template-columns: 1fr;
                gap: 30px;
                padding: 20px;
            }
        }

        .modal-images {
            position: relative;
        }

        .main-image {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .main-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-thumbnails {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .thumbnail.active {
            border-color: var(--secondary);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-info {
            display: flex;
            flex-direction: column;
        }

        .modal-category {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-title {
            font-size: 28px;
            color: var(--primary);
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .modal-price {
            font-size: 24px;
            color: var(--secondary);
            font-weight: 700;
            margin-bottom: 20px;
        }

        .modal-description {
            color: #555;
            line-height: 1.6;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #eee;
        }

        .modal-details {
            margin-bottom: 25px;
        }

        .modal-details h4 {
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        @media (max-width: 480px) {
            .details-grid {
                grid-template-columns: 1fr;
            }
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-item i {
            color: var(--secondary);
            width: 20px;
        }

        .modal-sizes {
            margin-bottom: 25px;
        }

        .modal-sizes h4 {
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .size-options-modal {
            display: flex;
            gap: 15px;
        }

        .size-option-modal {
            padding: 12px 24px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            min-width: 100px;
        }

        .size-option-modal:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .size-option-modal.selected {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: auto;
        }

        @media (max-width: 768px) {
            .modal-actions {
                flex-direction: column;
            }
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            border: 2px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            min-width: 120px;
        }

        .quantity-btn-modal {
            width: 40px;
            height: 50px;
            background-color: var(--light);
            border: none;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn-modal:hover {
            background-color: #ddd;
        }

        .quantity-display {
            flex: 1;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
            min-width: 40px;
        }

        .add-to-cart-modal {
            flex: 1;
            padding: 15px 25px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
        }

        .add-to-cart-modal:hover {
            background-color: var(--secondary);
        }

        .modal-stock {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            background-color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .in-stock {
            color: var(--success);
            font-weight: 600;
        }

        .low-stock {
            color: #f39c12;
            font-weight: 600;
        }

        .out-of-stock {
            color: #e74c3c;
            font-weight: 600;
        }

        .product-badge-modal {
            display: inline-block;
            padding: 5px 15px;
            background-color: var(--accent);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .type-badge-modal {
            background-color: var(--secondary);
        }

        /* Loading spinner for modal */
        .modal-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--light);
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
      <div class="product-modal-overlay" id="product-modal-overlay">
        <div class="product-modal" id="product-modal">
            <button class="modal-close" id="modal-close">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-content" id="modal-content">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>
    <!-- Header Top (Contact Info) -->
    <div class="header-top">
        <div class="container header-top-content">
            <div class="header-contact">
                <p> Livraison disponible partout au Maroc, gratuite √† partir de 1000dh | </p>
                
            </div>
            <div class="header-social">
                <a href="https://www.instagram.com/musk_and_amber_lovers/"><i class="fab fa-instagram"></i></a>
                <a href="https://www.tiktok.com/@muskwamber"><i class="fab fa-tiktok"></i></a>
            </div>
            <!-- Search Box -->
            <div class="header-search">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="search" class="search-input" id="productSearch" placeholder="Rechercher un produit...">
                </div>
            </div>
        </div>
    </div>

    <!-- Logo Section (Separated) -->
    <div class="logo-container">
        <!-- Mobile Hamburger Menu -->
        <div class="mobile-nav">
            <div class="hamburger-menu" id="hamburger-menu">
                <i class="fas fa-bars"></i>
            </div>
        </div>

        <div class="logo-wrapper">
            <div class="logo-circle">
                <img src="./logo.jpeg" alt="Musk & Amber" class="logo-img">
            </div>
            <div class="logo-text">Musk<span> & Amber</span></div>
        </div>
    </div>

    <!-- Main Navigation -->
    <nav class="main-nav">
        <div class="container nav-container">
            <!-- Desktop Navigation -->
            <div class="desktop-nav">
                <ul>
                    <li><a href="index.html">Accueil</a></li>
                    <li><a href="Categories.html" class="active">Cat√©gories</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li class="dropdown">
                        <a href="nouveaut√©s.html">Nouveaut√©s <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="nouveaut√©s.html"><i class="fas fa-female"></i> Parfums Femme</a>
                            <a href="nouveaut√©s.html"><i class="fas fa-male"></i> Parfums Homme</a>
                            <a href="nouveaut√©s.html"><i class="fas fa-mosque"></i> Parfums Arabes</a>
                            <a href="nouveaut√©s.html"><i class="fas fa-star"></i> Parfums de niche</a>
                            <a href="nouveaut√©s.html"><i class="fas fa-gift"></i> Coffrets Cadeaux</a>
                        </div>
                    </li>
                   
                </ul>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu (Outside main nav) -->
    <div class="mobile-menu" id="mobile-menu">
        <div class="close-menu" id="close-menu">
            <i class="fas fa-times"></i>
        </div>
        <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="javascript:void(0)" onclick="filterByCategory('femme')">Parfums femme</a></li>
            <li><a href="javascript:void(0)" onclick="filterByCategory('homme')">Parfums homme</a></li>
            <li><a href="javascript:void(0)" onclick="filterByCategory('arabes')">Parfum arabes</a></li>
            <li><a href="javascript:void(0)" onclick="filterByCategory('niche')">Parfum de niche</a></li>
            <li><a href="blog.html">blog</a></li>
            
            <li><a href="nouveaut√©s.html" id="mobile-nouveautes">Nouveaut√©s </a></li>
            
               
          
          
        </ul>
    </div>
    <div class="menu-overlay" id="menu-overlay"></div>
    <!-- Cart Icon (Floating) -->
    <div class="cart-icon" id="cart-icon">
        <i class="fas fa-shopping-bag"></i>
        <span class="cart-count">0</span>
    </div>

    <!-- Shopping Cart Sidebar -->
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h2 class="cart-title">Votre panier</h2>
            <div class="close-cart" id="close-cart">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="cart-content">
            <div class="cart-items" id="cart-items">
                <!-- Cart items will be dynamically loaded here -->
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cart-total-price">0.00 MAD</span>
            </div>
            <button class="checkout-btn" id="checkout-btn">Commander maintenant</button>
        </div>
    </div>
    <div class="menu-overlay" id="cart-overlay"></div>

    <!-- Checkout Form Overlay -->
    <div class="checkout-form-overlay" id="checkout-form-overlay">
        <div class="checkout-form-container">
            <h2 class="checkout-form-title">Finaliser votre commande</h2>
            <form id="checkout-form">
                <div class="form-group">
                    <label for="customer-name">Nom complet</label>
                    <input type="text" id="customer-name" required>
                </div>
                <div class="form-group">
                    <label for="customer-phone">Num√©ro de t√©l√©phone</label>
                    <input type="tel" id="customer-phone" required>
                </div>
                <div class="form-group">
                    <label for="customer-address">Adresse de livraison</label>
                    <textarea id="customer-address" required></textarea>
                </div>
                <div class="form-group">
                    <label for="customer-notes">Notes suppl√©mentaires (optionnel)</label>
                    <textarea id="customer-notes"></textarea>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="submit-order">Confirmer la commande</button>
                    <button type="button" class="cancel-order" id="cancel-order">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Categories Hero -->
    <section class="categories-hero">
        <div class="container hero-content">
            <h1 id="page-title">Nos Cat√©gories</h1>
            <p>D√©couvrez notre collection exclusive organis√©e par cat√©gories pour trouver le parfum qui vous correspond. Chaque fragrance raconte une histoire unique.</p>
        </div>
    </section>

    <!-- Category Info Banner (for filtered view) -->
    <div class="container" id="category-info-container" style="display: none;">
        <div class="category-info">
            <h3 id="current-category-title">Cat√©gorie s√©lectionn√©e</h3>
            <p id="current-category-description">Produits filtr√©s par cat√©gorie</p>
            <button class="clear-filter-btn" onclick="clearCategoryFilter()">
                <i class="fas fa-times"></i> Afficher toutes les cat√©gories
            </button>
        </div>
    </div>

    

    <!-- Products Section -->
    <section class="products-section">
        <div class="container">
            <h2 class="section-title" id="products-title">Tous nos Produits</h2>
            <div class="products-grid" id="products-container">
                <!-- Products will be loaded dynamically -->
            </div>
        </div>
    </section>

    <!-- Newsletter -->
    <section class="newsletter">
        <div class="container">
            <h2>Restez inform√©</h2>
            <p>Abonnez-vous √† notre newsletter pour recevoir en exclusivit√© nos nouvelles cat√©gories, offres sp√©ciales et conseils parfum√©s.</p>
            <form class="newsletter-form">
                <input type="email" class="newsletter-input" placeholder="Votre adresse email" required>
                <button type="submit" class="newsletter-button">S'abonner</button>
            </form>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Musk & Amber</h3>
                    <p>Votre destination pour des fragrances de luxe exceptionnelles qui √©veillent les sens et expriment votre personnalit√© unique.</p>
                    <div class="social-icons">
                      
                        <a href="https://www.instagram.com/musk_and_amber_lovers/"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.tiktok.com/@muskwamber"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Liens rapides</h3>
                    <ul>
                        <li><a href="index.html">Accueil</a></li>
                        <li><a href="Categories.html">Cat√©gories</a></li>
                        <li><a href="nouveaut√©s.html">Nouveaut√©s</a></li>
                        <li><a href="javascript:void(0)" onclick="filterByCategory('arabes')">Parfum arabes</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Informations</h3>
                    <ul>
                        <li><a href="about.html">√Ä propos de nous</a></li>
                        <li><a href="Contact.html">Contact</a></li>
                        
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact</h3>
                    <ul>
                        <li><i class="fas fa-phone"></i>  0668313435 </li>
                        
                        <li><i class="fas fa-map-marker-alt"></i> Morocco</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 Musk & Amber. Tous droits r√©serv√©s.</p>
            </div>
        </div>
    </footer>

   <script>
const firebaseConfig = {
    apiKey: "AIzaSyDxHAlR86M1U_-sBdLtZ6nEh0ssUREQY5M",
    authDomain: "muskandamber-83cd8.firebaseapp.com",
    projectId: "muskandamber-83cd8",
    storageBucket: "muskandamber-83cd8.firebasestorage.app",
    messagingSenderId: "820622006518",
    appId: "1:820622006518:web:540280c4c18f2e94ac74d7",
    measurementId: "G-58WS7ZEYG3"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let cart = JSON.parse(localStorage.getItem('muskandamber-cart')) || [];
let allCategories = {};
let currentCategory = null;
let allProductsList = [];
let currentPriceFilter = null;
let currentPromotionFilter = false;

// Global variables for product modal
let currentProductImages = [];
let currentProductSizes = [];
let currentProductId = '';
let currentProductStock = 'en stock';

// DOM Elements
const productsContainer = document.getElementById('products-container');
const categoriesGrid = document.getElementById('categories-grid');
const productsTitle = document.getElementById('products-title');
const categoryInfoContainer = document.getElementById('category-info-container');
const currentCategoryTitle = document.getElementById('current-category-title');
const currentCategoryDescription = document.getElementById('current-category-description');
const cartIcon = document.getElementById('cart-icon');
const cartCount = document.querySelector('.cart-count');
const cartSidebar = document.getElementById('cart-sidebar');
const closeCart = document.getElementById('close-cart');
const cartItems = document.getElementById('cart-items');
const cartTotalPrice = document.getElementById('cart-total-price');
const checkoutBtn = document.getElementById('checkout-btn');
const cartOverlay = document.getElementById('cart-overlay');
const hamburgerMenu = document.getElementById('hamburger-menu');
const mobileMenu = document.getElementById('mobile-menu');
const closeMenu = document.getElementById('close-menu');
const menuOverlay = document.getElementById('menu-overlay');
const checkoutFormOverlay = document.getElementById('checkout-form-overlay');
const checkoutForm = document.getElementById('checkout-form');
const cancelOrderBtn = document.getElementById('cancel-order');
const mobileNouveautes = document.getElementById('mobile-nouveautes');
const searchInput = document.getElementById('productSearch');
const productModalOverlay = document.getElementById('product-modal-overlay');
const productModal = document.getElementById('product-modal');
const modalClose = document.getElementById('modal-close');
const modalContent = document.getElementById('modal-content');

// ========== FILTER VARIABLES ==========
let selectedCategories = [];
let selectedStockStatuses = [];
let isMultipleSelectionMode = false; // New variable to track selection mode

// ========== DOMContentLoaded event ==========
document.addEventListener('DOMContentLoaded', function() {
    // Check if we came from index.html with a category filter
    checkForCategoryFilter();
    
    // Load categories and products from Firebase
    loadProductsFromFirebase();
    
    // Initialize cart functionality
    initCart();
    updateCartUI();
    
    // Initialize mobile menu
    initMobileMenu();
    
    // Initialize checkout form
    initCheckoutForm();
    
    // Initialize search functionality
    initSearch();
    
    // Initialize product modal
    initProductModal();
    
    // Add promotion filter to mobile menu
    addPromotionFilterToMenu();
    
    // Add keyboard listeners for Ctrl/Cmd click
    document.addEventListener('keydown', function(e) {
        // Enable multiple selection mode when Ctrl or Cmd is pressed
        if (e.ctrlKey || e.metaKey) {
            isMultipleSelectionMode = true;
        }
    });
    
    document.addEventListener('keyup', function(e) {
        // Disable multiple selection mode when Ctrl or Cmd is released
        if (!e.ctrlKey && !e.metaKey) {
            isMultipleSelectionMode = false;
        }
    });
});

// Add promotion filter to mobile menu
function addPromotionFilterToMenu() {
    const mobileMenuList = document.querySelector('.mobile-menu ul');
    if (mobileMenuList) {
        const existingPromotionItem = mobileMenuList.querySelector('a[onclick*="filterByPromotion"]');
        if (!existingPromotionItem) {
            const promotionItem = document.createElement('li');
            promotionItem.innerHTML = `
                <a href="javascript:void(0)" onclick="filterByPromotion()">
                    <i class="fas fa-tag"></i> Promotion
                </a>
            `;
            const aboutLink = mobileMenuList.querySelector('a[href="about.html"]');
            if (aboutLink) {
                aboutLink.parentElement.before(promotionItem);
            }
        }
    }
}

// Initialize mobile menu
function initMobileMenu() {
    // Open mobile menu
    if (hamburgerMenu) {
        hamburgerMenu.addEventListener('click', function() {
            if (mobileMenu) mobileMenu.classList.add('active');
            if (menuOverlay) menuOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
    }
    
    // Close mobile menu
    if (closeMenu) {
        closeMenu.addEventListener('click', function() {
            if (mobileMenu) mobileMenu.classList.remove('active');
            if (menuOverlay) menuOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
    }
    
    if (menuOverlay) {
        menuOverlay.addEventListener('click', function() {
            if (mobileMenu) mobileMenu.classList.remove('active');
            if (menuOverlay) menuOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
    }
}

// Initialize search functionality
function initSearch() {
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            searchProducts(searchTerm);
        });
    }
}

// Search products function
function searchProducts(searchTerm) {
    if (!allProductsList || allProductsList.length === 0) return;
    
    if (!productsContainer) return;
    productsContainer.innerHTML = '';
    
    if (searchTerm.trim() === '') {
        applyFilters();
        return;
    }
    
    // Filter products based on search term
    let filteredProducts = allProductsList.filter(product => {
        const productName = product.name ? product.name.toLowerCase() : '';
        const productBrand = product.brand ? product.brand.toLowerCase() : '';
        const productCategory = product.category ? product.category.toLowerCase() : '';
        const productDescription = product.description ? product.description.toLowerCase() : '';
        const productType = product.type ? product.type.toLowerCase() : '';
        
        return productName.includes(searchTerm) || 
               productBrand.includes(searchTerm) ||
               productCategory.includes(searchTerm) ||
               productDescription.includes(searchTerm) ||
               productType.includes(searchTerm);
    });
    
    if (filteredProducts.length === 0) {
        productsContainer.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <h3>Aucun r√©sultat trouv√©</h3>
                <p>Aucun produit ne correspond √† votre recherche: "${searchTerm}"</p>
            </div>
        `;
    } else {
        // Clear container and add products directly
        filteredProducts.forEach(product => {
            const productCard = createProductCard(product);
            productsContainer.appendChild(productCard);
        });
    }
}

// Check if we have a category filter from index.html
function checkForCategoryFilter() {
    const selectedCategory = localStorage.getItem('selectedCategory');
    
    if (selectedCategory) {
        // Set current category
        selectedCategories = [selectedCategory];
        
        // Show category info banner
        if (categoryInfoContainer) categoryInfoContainer.style.display = 'block';
        if (currentCategoryTitle) currentCategoryTitle.textContent = getCategoryDisplayName(selectedCategory);
        if (currentCategoryDescription) currentCategoryDescription.textContent = getCategoryDescription(selectedCategory);
        
        // Update products title
        if (productsTitle) productsTitle.textContent = `Produits - ${getCategoryDisplayName(selectedCategory)}`;
        
        // Clear localStorage
        localStorage.removeItem('selectedCategory');
    }
}

// Get category display name (FIXED: use "niche" without 's')
function getCategoryDisplayName(categoryKey) {
    const categoryMap = {
        'femme': 'Parfums Femme',
        'homme': 'Parfums Homme',
        'arabes': 'Parfums Arabes',
        'niche': 'Parfums de niche',
        'coffrets': 'Coffrets Cadeaux',
        'nouveautes': 'Nouveaut√©s',
        'promotion': 'Promotions'
    };
    
    // Normalize the key - convert "niches" to "niche"
    const normalizedKey = categoryKey.toLowerCase();
    const finalKey = normalizedKey === 'niches' ? 'niche' : normalizedKey;
    
    return categoryMap[finalKey] || finalKey.charAt(0).toUpperCase() + finalKey.slice(1);
}

// Get category description (FIXED: use "niche" without 's')
function getCategoryDescription(categoryKey) {
    const descriptionMap = {
        'femme': 'Des fragrances d√©licates et envo√ªtantes pour la femme moderne',
        'homme': 'Des essences bois√©es et sophistiqu√©es pour l\'homme √©l√©gant',
        'arabes': 'Des fragrances orientales riches en oud et en notes √©pic√©es',
        'niche': 'Des cr√©ations exclusives et rares pour les connaisseurs',
        'coffrets': 'Des ensembles cadeaux parfaits pour toutes les occasions',
        'nouveautes': 'D√©couvrez nos derni√®res arriv√©es et cr√©ations exclusives',
        'promotion': 'Profitez de nos offres sp√©ciales et produits en promotion'
    };
    
    const normalizedKey = categoryKey.toLowerCase();
    const finalKey = normalizedKey === 'niches' ? 'niche' : normalizedKey;
    
    return descriptionMap[finalKey] || 'D√©couvrez notre collection de produits dans cette cat√©gorie';
}

// Clear category filter
function clearCategoryFilter() {
    selectedCategories = [];
    selectedStockStatuses = [];
    currentPromotionFilter = false;
    
    // Reset products title
    if (productsTitle) productsTitle.textContent = 'Tous nos Produits';
    
    // Hide category info banner
    if (categoryInfoContainer) categoryInfoContainer.style.display = 'none';
    
    // Clear search
    if (searchInput) searchInput.value = '';
    
    // Show all products
    displayAllProducts();
}

// Get product stock statuses (handles both array and string formats)
function getProductStockStatuses(product) {
    if (product.stockStatuses && Array.isArray(product.stockStatuses)) {
        return product.stockStatuses;
    } else if (product.stockStatus && Array.isArray(product.stockStatus)) {
        return product.stockStatus;
    } else if (product.stockStatus && typeof product.stockStatus === 'string') {
        return [product.stockStatus];
    } else if (product.stockStatuses && typeof product.stockStatuses === 'string') {
        return [product.stockStatuses];
    } else {
        return ['en stock'];
    }
}

// Filter by promotion
function filterByPromotion() {
    currentPromotionFilter = true;
    selectedCategories = [];
    selectedStockStatuses = ['promotion'];
    
    // Update UI
    if (categoryInfoContainer) categoryInfoContainer.style.display = 'block';
    if (currentCategoryTitle) currentCategoryTitle.textContent = 'Promotions';
    if (currentCategoryDescription) currentCategoryDescription.textContent = 'Profitez de nos offres sp√©ciales et produits en promotion';
    
    // Update products title
    if (productsTitle) productsTitle.textContent = 'Produits en Promotion';
    
    // Apply filters
    applyFilters();
    
    // Clear search
    if (searchInput) searchInput.value = '';
    
    // Close mobile menu if open
    const mobileMenu = document.getElementById('mobile-menu');
    const menuOverlay = document.getElementById('menu-overlay');
    
    if (mobileMenu && mobileMenu.classList.contains('active')) {
        mobileMenu.classList.remove('active');
        if (menuOverlay) menuOverlay.classList.remove('active');
        document.body.style.overflow = '';
    }
}

// ========== FILTER BY CATEGORY FUNCTION (UPDATED with dual modes) ==========
function filterByCategory(categoryKey, forceMultiple = false) {
    if (typeof categoryKey === 'string') {
        // Reset promotion filter when selecting other category
        currentPromotionFilter = false;
        selectedStockStatuses = [];
        
        // Convert "niches" to "niche" if needed
        const normalizedKey = categoryKey.toLowerCase();
        const finalKey = normalizedKey === 'niches' ? 'niche' : normalizedKey;
        
        // Check if we're in multiple selection mode (Ctrl/Cmd pressed) or forced multiple
        const useMultipleMode = forceMultiple || isMultipleSelectionMode;
        
        if (!useMultipleMode) {
            // SINGLE SELECTION MODE: Replace all selected categories with the new one
            selectedCategories = [finalKey];
        } else {
            // MULTIPLE SELECTION MODE: Toggle the category
            const existingIndex = selectedCategories.indexOf(finalKey);
            
            if (existingIndex !== -1) {
                // Remove category if already selected
                selectedCategories.splice(existingIndex, 1);
            } else {
                // Add category if not selected
                selectedCategories.push(finalKey);
            }
        }
        
        // Update UI based on selection
        if (selectedCategories.length === 0) {
            // No categories selected
            if (categoryInfoContainer) categoryInfoContainer.style.display = 'none';
            if (productsTitle) productsTitle.textContent = 'Tous nos Produits';
        } else {
            // Show category info with multiple categories
            if (categoryInfoContainer) categoryInfoContainer.style.display = 'block';
            
            if (selectedCategories.length === 1) {
                // Single category selected
                const categoryName = selectedCategories[0];
                if (currentCategoryTitle) currentCategoryTitle.textContent = getCategoryDisplayName(categoryName);
                if (currentCategoryDescription) currentCategoryDescription.textContent = getCategoryDescription(categoryName);
                if (productsTitle) productsTitle.textContent = `Produits - ${getCategoryDisplayName(categoryName)}`;
            } else {
                // Multiple categories selected
                const categoryNames = selectedCategories.map(cat => getCategoryDisplayName(cat)).join(' & ');
                if (currentCategoryTitle) currentCategoryTitle.textContent = `Filtres: ${categoryNames}`;
                if (currentCategoryDescription) currentCategoryDescription.textContent = `Produits correspondant √†: ${categoryNames}`;
                if (productsTitle) productsTitle.textContent = `Produits - ${categoryNames}`;
            }
        }
        
        // Apply filters
        applyFilters();
        
        // Clear search
        if (searchInput) searchInput.value = '';
        
        // Close mobile menu if open
        const mobileMenu = document.getElementById('mobile-menu');
        const menuOverlay = document.getElementById('menu-overlay');
        
        if (mobileMenu && mobileMenu.classList.contains('active')) {
            mobileMenu.classList.remove('active');
            if (menuOverlay) menuOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }
    }
}

// ========== LOAD PRODUCTS FROM FIREBASE ==========
async function loadProductsFromFirebase() {
    try {
        if (!productsContainer) {
            console.warn('productsContainer not found on this page');
            return;
        }
        
        const snapshot = await db.collection('products').orderBy('createdAt', 'desc').get();
        allProductsList = [];
        
        snapshot.forEach(doc => {
            const data = doc.data();
            allProductsList.push({
                id: doc.id,
                ...data,
                createdAt: data.createdAt ? data.createdAt.toDate() : new Date()
            });
        });
        
        // Apply filters after loading
        applyFilters();
        
        console.log(`Loaded ${allProductsList.length} products from Firebase`);
        
    } catch (error) {
        console.error('Error loading products:', error);
        if (productsContainer) {
            productsContainer.innerHTML = '<p class="error-message">Erreur lors du chargement des produits. Veuillez r√©essayer plus tard.</p>';
        }
    }
}

// ========== APPLY FILTERS FUNCTION (UPDATED with dual logic) ==========
function applyFilters() {
    if (!productsContainer || !allProductsList || allProductsList.length === 0) {
        return;
    }
    
    // Clear the container
    productsContainer.innerHTML = '';
    
    // Filter products based on selected category
    let filteredProducts = [];
    
    if (selectedCategories.length === 0 && selectedStockStatuses.length === 0) {
        // No filters selected, show all products
        filteredProducts = allProductsList;
    } else {
        // Filter products based on selected criteria
        filteredProducts = allProductsList.filter(product => {
            // Get product categories
            const productCategories = product.categories || (product.category ? product.category.split(',') : []);
            const productTypes = product.type ? [product.type] : [];
            const allProductCategories = [...productCategories, ...productTypes];
            
            // Get product stock statuses
            const productStockStatuses = getProductStockStatuses(product);
            
            // Check if product matches categories
            let categoryMatch = true;
            if (selectedCategories.length > 0) {
                if (selectedCategories.length === 1) {
                    // SINGLE CATEGORY: Use OR logic - show products in this category
                    categoryMatch = selectedCategories.some(selectedCat => {
                        // Convert selected category to normalized form
                        const normalizedSelectedCat = selectedCat.toLowerCase();
                        
                        return allProductCategories.some(productCat => {
                            if (productCat && typeof productCat === 'string') {
                                const normalizedProductCat = productCat.toLowerCase();
                                
                                // Handle "niche" category - accept both "niche" and "niches" in database
                                if (normalizedSelectedCat === 'niche') {
                                    return normalizedProductCat === 'niche' || normalizedProductCat === 'niches';
                                }
                                
                                return normalizedProductCat === normalizedSelectedCat;
                            }
                            return false;
                        });
                    });
                } else {
                    // MULTIPLE CATEGORIES: Use AND logic - show products in ALL selected categories
                    categoryMatch = selectedCategories.every(selectedCat => {
                        // Convert selected category to normalized form
                        const normalizedSelectedCat = selectedCat.toLowerCase();
                        
                        return allProductCategories.some(productCat => {
                            if (productCat && typeof productCat === 'string') {
                                const normalizedProductCat = productCat.toLowerCase();
                                
                                // Handle "niche" category - accept both "niche" and "niches" in database
                                if (normalizedSelectedCat === 'niche') {
                                    return normalizedProductCat === 'niche' || normalizedProductCat === 'niches';
                                }
                                
                                return normalizedProductCat === normalizedSelectedCat;
                            }
                            return false;
                        });
                    });
                }
            }
            
            // Check if product matches selected stock statuses (if any)
            let stockStatusMatch = true;
            if (selectedStockStatuses.length > 0) {
                stockStatusMatch = selectedStockStatuses.some(status => 
                    productStockStatuses.includes(status)
                );
            }
            
            return categoryMatch && stockStatusMatch;
        });
    }
    
    // Display products
    if (filteredProducts.length === 0) {
        productsContainer.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-box-open"></i>
                <h3>Aucun produit trouv√©</h3>
                <p>Aucun produit ne correspond aux filtres s√©lectionn√©s. Essayez de modifier vos filtres.</p>
                <button class="clear-filter-btn" onclick="clearCategoryFilter()">
                    <i class="fas fa-times"></i> Effacer tous les filtres
                </button>
            </div>
        `;
        return;
    }
    
    // Add each product card directly to the container
    filteredProducts.forEach(product => {
        const productCard = createProductCard(product);
        productsContainer.appendChild(productCard);
    });
}

// Display all products
function displayAllProducts() {
    // Update title
    if (productsTitle) productsTitle.textContent = 'Tous nos Produits';
    
    // Reset all filters
    currentPromotionFilter = false;
    selectedCategories = [];
    selectedStockStatuses = [];
    
    // Display all products
    if (productsContainer) {
        productsContainer.innerHTML = '';
        allProductsList.forEach(product => {
            const productCard = createProductCard(product);
            productsContainer.appendChild(productCard);
        });
    }
}

// ========== CREATE PRODUCT CARD WITH REAL DATA FROM DATABASE ==========
function createProductCard(product) {
    const div = document.createElement('div');
    div.className = 'product-card';
    
    // Get main image (first image from array or single imageUrl)
    const mainImage = product.imageUrls && product.imageUrls.length > 0 
        ? product.imageUrls[0] 
        : (product.imageUrl || 'https://images.unsplash.com/photo-1590736966891-6e59a8e5c135?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80');
    
    // Get actual volume from database
    let volumeDisplay = '';
    let actualVolume = '';
    if (product.volume) {
        const volumes = product.volume.split(',').map(v => v.trim());
        actualVolume = volumes[0];
        volumeDisplay = `<div class="product-volume">${actualVolume}${actualVolume.includes('ml') ? '' : 'ml'}</div>`;
    } else {
        actualVolume = '50';
        volumeDisplay = `<div class="product-volume">50ml</div>`;
    }
    
    // Get actual stock status from database
    const stockStatuses = getProductStockStatuses(product);
    
    // Check if product is in promotion
    const isPromotion = stockStatuses.includes('promotion');
    
    // Set price color based on promotion status
    const priceColor = isPromotion ? '#e74c3c' : '#3e1b2a';
    const priceStyle = `color: ${priceColor}; font-weight: bold;`;
    
    // Create stock status badges
    let stockStatusBadges = '';
    if (stockStatuses.length > 0) {
        stockStatuses.forEach(status => {
            let badgeClass = '';
            let badgeIcon = '';
            
            switch(status.toLowerCase()) {
                case 'en stock':
                    badgeClass = 'in-stock-badge';
                    badgeIcon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'rupture de stock':
                    badgeClass = 'out-of-stock-badge';
                    badgeIcon = '<i class="fas fa-times-circle"></i>';
                    break;
                case 'promotion':
                    badgeClass = 'promotion-badge';
                    badgeIcon = '<i class="fas fa-tag"></i>';
                    break;
                case 'nouveaut√©':
                    badgeClass = 'new-badge';
                    badgeIcon = '<i class="fas fa-star"></i>';
                    break;
                default:
                    badgeClass = 'stock-badge';
                    badgeIcon = '<i class="fas fa-info-circle"></i>';
            }
            
            stockStatusBadges += `
                <div class="stock-status-badge ${badgeClass}">
                    ${badgeIcon} ${status}
                </div>
            `;
        });
    }
    
    // Create promotion badge if applicable
    let promotionBadge = '';
    if (isPromotion) {
        promotionBadge = '<div class="product-badge promotion-badge">Promotion</div>';
    }
    
    // Create type badge if product has a type
    let typeBadge = '';
    if (product.type) {
        // Normalize type - convert "niches" to "niche"
        const normalizedType = product.type.toLowerCase();
        const finalType = normalizedType === 'niches' ? 'niche' : normalizedType;
        
        const typeClass = `type-${finalType}`;
        const typeName = getTypeDisplayName(finalType);
        typeBadge = `<div class="product-badge ${typeClass}">${typeName}</div>`;
    }
    
    // Get brand if available
    const brandDisplay = product.brand ? `<div class="product-brand">${product.brand}</div>` : '';
    
    // FIXED: Normalize category display - convert "niches" to "niche"
    const categoryDisplay = (product.category || 'Parfum').toLowerCase();
    const displayCategory = categoryDisplay === 'niches' ? 'niche' : categoryDisplay;
    
    div.innerHTML = `
        ${promotionBadge}
        ${typeBadge}
        <div class="product-image" style="background-image: url('${mainImage}')">
            <div class="product-overlay">
                <button class="quick-view" onclick="viewProduct('${product.id}')">Vue rapide</button>
            </div>
        </div>
        <div class="product-info">
            <div class="product-category">${displayCategory.charAt(0).toUpperCase() + displayCategory.slice(1)}</div>
            ${brandDisplay}
            <h3 class="product-title">${product.name}</h3>
            <div class="product-price" style="${priceStyle}">${parseFloat(product.price).toFixed(2)} MAD</div>
            ${volumeDisplay}
            <div class="stock-badges-container">
                ${stockStatusBadges}
            </div>
            <button class="add-to-cart" data-id="${product.id}" data-volume="${actualVolume}" 
                    ${stockStatuses.includes('rupture de stock') ? 'disabled style="background-color: #ccc;"' : ''}>
                ${stockStatuses.includes('rupture de stock') ? 'Rupture de stock' : 'Ajouter au panier'}
            </button>
        </div>
    `;
    
    return div;
}

// Get type display name (FIXED: use "niche" without 's')
function getTypeDisplayName(type) {
    const typeMap = {
        'homme': 'Homme',
        'femme': 'Femme',
        'arabes': 'Arabe',
        'niche': 'Niche'
    };
    
    const normalizedType = type.toLowerCase();
    const finalType = normalizedType === 'niches' ? 'niche' : normalizedType;
    
    return typeMap[finalType] || finalType.charAt(0).toUpperCase() + finalType.slice(1);
}

// ========== CART FUNCTIONS ==========
function initCart() {
    // Check if cart icon exists
    if (!cartIcon) return;
    
    // Cart icon click event
    cartIcon.addEventListener('click', function() {
        if (cartSidebar) cartSidebar.classList.add('active');
        if (cartOverlay) cartOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
    });

    // Close cart events
    if (closeCart) {
        closeCart.addEventListener('click', function() {
            if (cartSidebar) cartSidebar.classList.remove('active');
            if (cartOverlay) cartOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
    }

    if (cartOverlay) {
        cartOverlay.addEventListener('click', function() {
            if (cartSidebar) cartSidebar.classList.remove('active');
            if (cartOverlay) cartOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
    }

    // Add to cart buttons - Event delegation for dynamically created buttons
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('add-to-cart') && !e.target.disabled) {
            const productId = e.target.getAttribute('data-id');
            addToCart(productId, e.target);
            
            // Auto-open cart on mobile after adding item
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    if (cartSidebar) cartSidebar.classList.add('active');
                    if (cartOverlay) cartOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }, 500);
            }
        }
    });

    // Checkout button
    if (checkoutBtn) {
        checkoutBtn.addEventListener('click', function() {
            if (cart.length === 0) {
                showNotification('Votre panier est vide', 'error');
                return;
            }
            if (checkoutFormOverlay) checkoutFormOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
    }
}

async function addToCart(productId, clickedElement = null) {
    try {
        // Get product details from Firebase
        const doc = await db.collection('products').doc(productId).get();
        
        if (doc.exists) {
            const product = doc.data();
            
            // Check stock status
            const stockStatuses = getProductStockStatuses(product);
            if (stockStatuses.includes('rupture de stock')) {
                showNotification('Ce produit est en rupture de stock', 'error');
                return;
            }
            
            // Get the actual volume from the product data
            let defaultSize = '50ml'; // Default fallback
            if (product.volume) {
                const volumes = product.volume.split(',').map(v => v.trim());
                defaultSize = volumes[0] + (volumes[0].includes('ml') ? '' : 'ml');
            }
            
            // Check if clicked element has a data-volume attribute
            if (clickedElement && clickedElement.getAttribute('data-volume')) {
                const clickedVolume = clickedElement.getAttribute('data-volume');
                defaultSize = clickedVolume + (clickedVolume.includes('ml') ? '' : 'ml');
            }
            
            // Check if product already exists in cart with same size
            const existingItemIndex = cart.findIndex(item => item.id === productId && item.size === defaultSize);
            
            if (existingItemIndex !== -1) {
                // If product exists with same size, increase quantity
                cart[existingItemIndex].quantity += 1;
            } else {
                // Add new item with actual size from database
                cart.push({
                    id: productId,
                    name: product.name,
                    price: parseFloat(product.price),
                    imageUrl: product.imageUrls && product.imageUrls.length > 0 ? product.imageUrls[0] : product.imageUrl,
                    quantity: 1,
                    size: defaultSize,
                    volume: defaultSize,
                    brand: product.brand || ''
                });
            }
            
            saveCartToStorage();
            updateCartUI();
            
            // Show notification
            showNotification(`${product.name} (${defaultSize}) ajout√© au panier!`, 'success');
            
            // Animation effect on add to cart button
            const addButton = clickedElement || document.querySelector(`.add-to-cart[data-id="${productId}"]`);
            if (addButton) {
                const originalText = addButton.textContent;
                addButton.textContent = 'Ajout√© !';
                addButton.style.backgroundColor = '#27ae60';
                
                setTimeout(() => {
                    addButton.textContent = originalText;
                    addButton.style.backgroundColor = '';
                }, 1500);
            }
        } else {
            console.error('Product not found in database:', productId);
            showNotification('Produit non trouv√©', 'error');
        }
    } catch (error) {
        console.error('Error adding to cart:', error);
        showNotification('Erreur lors de l\'ajout au panier', 'error');
    }
}

function updateCartUI() {
    // Update cart count
    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
    if (cartCount) cartCount.textContent = totalItems;
    
    // Update cart items
    if (!cartItems) return;
    
    cartItems.innerHTML = '';
    
    if (cart.length === 0) {
        cartItems.innerHTML = `
            <div class="empty-cart">
                <i class="fas fa-shopping-bag"></i>
                <p>Votre panier est vide</p>
            </div>
        `;
    } else {
        cart.forEach((item, index) => {
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            
            // Display brand if available
            const brandDisplay = item.brand ? `<div class="cart-item-brand" style="font-size: 12px; color: #666; margin-bottom: 5px;">${item.brand}</div>` : '';
            
            cartItem.innerHTML = `
                <div class="cart-item-image" style="background-image: url('${item.imageUrl}');"></div>
                <div class="cart-item-details">
                    ${brandDisplay}
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-price" style="color: #e74c3c; font-weight: bold;">${item.price.toFixed(2)} MAD</div>
                    <div class="cart-item-size">
                        <small>Volume: ${item.size || item.volume || '50ml'}</small>
                        <div class="size-options">
                            <span class="size-option ${item.size === item.size ? 'selected' : ''}" 
                                  data-index="${index}" data-size="${item.size}">
                                ${item.size}
                            </span>
                        </div>
                    </div>
                    <div class="cart-item-controls">
                        <button class="quantity-btn decrease-quantity" data-index="${index}">-</button>
                        <span class="cart-item-quantity">${item.quantity}</span>
                        <button class="quantity-btn increase-quantity" data-index="${index}">+</button>
                        <button class="remove-item" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            cartItems.appendChild(cartItem);
        });
        
        // Add event listeners for size options
        document.querySelectorAll('.size-option').forEach(option => {
            option.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));
                const size = this.getAttribute('data-size');
                updateCartItemSize(index, size);
            });
        });
        
        // Add event listeners for quantity buttons
        document.querySelectorAll('.decrease-quantity').forEach(btn => {
            btn.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));
                updateQuantity(index, -1);
            });
        });
        
        document.querySelectorAll('.increase-quantity').forEach(btn => {
            btn.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));
                updateQuantity(index, 1);
            });
        });
        
        document.querySelectorAll('.remove-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));
                removeFromCart(index);
            });
        });
    }
    
    // Update total price
    const totalPrice = cart.reduce((total, item) => {
        return total + (item.price * item.quantity);
    }, 0);
    if (cartTotalPrice) cartTotalPrice.textContent = `${totalPrice.toFixed(2)} MAD`;
}

function updateCartItemSize(index, size) {
    if (cart[index]) {
        cart[index].size = size;
        saveCartToStorage();
        updateCartUI();
    }
}

function saveCartToStorage() {
    localStorage.setItem('muskandamber-cart', JSON.stringify(cart));
}

function updateQuantity(index, change) {
    if (cart[index]) {
        cart[index].quantity += change;
        
        if (cart[index].quantity <= 0) {
            removeFromCart(index);
        } else {
            saveCartToStorage();
            updateCartUI();
        }
    }
}

function removeFromCart(index) {
    if (cart[index]) {
        const removedItem = cart[index];
        cart.splice(index, 1);
        saveCartToStorage();
        updateCartUI();
        showNotification(`${removedItem.name} retir√© du panier!`);
    }
}

// ========== CHECKOUT FUNCTIONS ==========
function initCheckoutForm() {
    // Cancel order button
    if (cancelOrderBtn) {
        cancelOrderBtn.addEventListener('click', function() {
            if (checkoutFormOverlay) checkoutFormOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
    }

    // Form submission
    if (checkoutForm) {
        checkoutForm.addEventListener('submit', function(e) {
            e.preventDefault();
            submitOrder();
        });
    }

    // Close checkout form when clicking outside
    if (checkoutFormOverlay) {
        checkoutFormOverlay.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }
}

async function submitOrder() {
    const name = document.getElementById('customer-name')?.value;
    const phone = document.getElementById('customer-phone')?.value;
    const address = document.getElementById('customer-address')?.value;
    const notes = document.getElementById('customer-notes')?.value;
    
    if (!name || !phone || !address) {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
        return;
    }
    
    const totalPrice = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    
    const order = {
        customer: { name, phone, address, notes },
        items: cart,
        total: totalPrice,
        status: 'pending',
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        orderNumber: 'ORD-' + Date.now()
    };
    
    try {
        await db.collection('orders').add(order);
        showNotification('Commande pass√©e avec succ√®s!', 'success');
        
        // Clear cart
        cart = [];
        saveCartToStorage();
        updateCartUI();
        
        // Close checkout form
        if (checkoutFormOverlay) checkoutFormOverlay.classList.remove('active');
        document.body.style.overflow = '';
        
        // Clear form
        if (checkoutForm) checkoutForm.reset();
    } catch (error) {
        console.error('Error submitting order:', error);
        showNotification('Erreur lors de la soumission de la commande', 'error');
    }
}

// ========== PRODUCT MODAL FUNCTIONS ==========
function initProductModal() {
    // Close modal when clicking close button
    if (modalClose) {
        modalClose.addEventListener('click', function() {
            if (productModalOverlay) productModalOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
    }

    // Close modal when clicking outside
    if (productModalOverlay) {
        productModalOverlay.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && productModalOverlay && productModalOverlay.classList.contains('active')) {
            productModalOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }
    });
}

async function viewProduct(productId) {
    try {
        // Show loading state
        if (modalContent) {
            modalContent.innerHTML = `
                <div class="modal-loading">
                    <div class="spinner"></div>
                </div>
            `;
        }
        
        // Show modal
        if (productModalOverlay) productModalOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Get product details from Firebase
        const doc = await db.collection('products').doc(productId).get();
        
        if (doc.exists) {
            const product = doc.data();
            currentProductId = productId;
            
            // Get stock statuses
            const stockStatuses = getProductStockStatuses(product);
            const isPromotion = stockStatuses.includes('promotion');
            
            // Set price color based on promotion
            const priceColor = isPromotion ? '#e74c3c' : '#561e4b';
            const priceStyle = `color: ${priceColor}; font-weight: bold;`;
            
            // Prepare images array from imageUrls or imageUrl
            currentProductImages = product.imageUrls && product.imageUrls.length > 0 
                ? product.imageUrls 
                : [product.imageUrl || 'https://images.unsplash.com/photo-1590736966891-6e59a8e5c135?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'];
            
            // Prepare sizes array based on volume field
            let volumes = [];
            if (product.volume) {
                if (product.volume.includes(',')) {
                    volumes = product.volume.split(',').map(v => v.trim() + 'ml');
                } else {
                    volumes = [product.volume + 'ml'];
                }
            } else {
                volumes = ['50ml', '100ml'];
            }
            currentProductSizes = volumes;
            
            // Get brand if available
            const brandDisplay = product.brand ? `<div class="product-brand-modal">Marque: ${product.brand}</div>` : '';
            
            // FIXED: Normalize category display - convert "niches" to "niche"
            const categoryDisplay = (product.category || 'Parfum').toLowerCase();
            const displayCategory = categoryDisplay === 'niches' ? 'niche' : categoryDisplay;
            
            // Create stock status display
            let stockStatusDisplay = '';
            stockStatuses.forEach(status => {
                let stockClass = '';
                let stockIcon = '';
                
                switch(status.toLowerCase()) {
                    case 'en stock':
                        stockClass = 'in-stock';
                        stockIcon = '<i class="fas fa-check-circle"></i>';
                        break;
                    case 'rupture de stock':
                        stockClass = 'out-of-stock';
                        stockIcon = '<i class="fas fa-times-circle"></i>';
                        break;
                    case 'promotion':
                        stockClass = 'promotion-stock';
                        stockIcon = '<i class="fas fa-tag"></i>';
                        break;
                    case 'nouveaut√©':
                        stockClass = 'new-stock';
                        stockIcon = '<i class="fas fa-star"></i>';
                        break;
                }
                
                stockStatusDisplay += `
                    <div class="detail-item">
                        ${stockIcon}
                        <span class="${stockClass}" style="font-weight: bold;">${status}</span>
                    </div>
                `;
            });
            
            // Create modal content
            if (modalContent) {
                modalContent.innerHTML = `
                    <div class="modal-images">
                        <div class="main-image">
                            <img src="${currentProductImages[0]}" alt="${product.name}" id="main-modal-image">
                        </div>
                        ${currentProductImages.length > 1 ? `
                            <div class="image-thumbnails">
                                ${currentProductImages.map((img, index) => `
                                    <div class="thumbnail ${index === 0 ? 'active' : ''}" data-index="${index}">
                                        <img src="${img}" alt="${product.name} - Vue ${index + 1}">
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <div class="modal-info">
                        ${brandDisplay}
                        <div class="modal-category">${displayCategory.charAt(0).toUpperCase() + displayCategory.slice(1)}</div>
                        <h1 class="modal-title">${product.name}</h1>
                        <div class="modal-price" style="${priceStyle}; font-size: 28px;">${parseFloat(product.price).toFixed(2)} MAD</div>
                        
                        ${product.description ? `
                            <div class="modal-description">
                                ${product.description}
                            </div>
                        ` : ''}
                        
                        <div class="modal-details">
                            <h4>D√©tails du produit</h4>
                            <div class="details-grid">
                                ${product.volume ? `
                                    <div class="detail-item">
                                        <i class="fas fa-weight"></i>
                                        <span>Volume disponible: ${product.volume}ml</span>
                                    </div>
                                ` : ''}
                                ${product.brand ? `
                                    <div class="detail-item">
                                        <i class="fas fa-tag"></i>
                                        <span>Marque: ${product.brand}</span>
                                    </div>
                                ` : ''}
                                ${stockStatusDisplay}
                            </div>
                        </div>
                        
                        <div class="modal-sizes">
                            <h4>S√©lectionnez le volume:</h4>
                            <div class="size-options-modal">
                                ${currentProductSizes.map(size => `
                                    <div class="size-option-modal ${size === (currentProductSizes[0] || '50ml') ? 'selected' : ''}" data-size="${size}">
                                        ${size}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <div class="quantity-selector">
                                <button class="quantity-btn-modal" id="decrease-quantity-modal">-</button>
                                <span class="quantity-display" id="quantity-display-modal">1</span>
                                <button class="quantity-btn-modal" id="increase-quantity-modal">+</button>
                            </div>
                            <button class="add-to-cart-modal" data-id="${productId}" id="add-to-cart-modal" 
                                    ${stockStatuses.includes('rupture de stock') ? 'style="background-color: #ccc;"' : ''}>
                                <i class="fas fa-shopping-cart"></i> ${stockStatuses.includes('rupture de stock') ? 'Rupture de stock' : 'Ajouter au panier'}
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners for modal
                addModalEventListeners();
            }
        } else {
            if (modalContent) {
                modalContent.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 48px; color: #e74c3c; margin-bottom: 20px;"></i>
                        <h3>Produit non trouv√©</h3>
                        <p>Le produit demand√© n'existe pas ou a √©t√© supprim√©.</p>
                        <button class="clear-filter-btn" onclick="productModalOverlay.classList.remove('active'); document.body.style.overflow = '';">
                            <i class="fas fa-times"></i> Fermer
                        </button>
                    </div>
                `;
            }
        }
        
    } catch (error) {
        console.error('Error loading product details:', error);
        if (modalContent) {
            modalContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #f39c12; margin-bottom: 20px;"></i>
                    <h3>Erreur de chargement</h3>
                    <p>Impossible de charger les d√©tails du produit. Veuillez r√©essayer.</p>
                    <button class="clear-filter-btn" onclick="productModalOverlay.classList.remove('active'); document.body.style.overflow = '';">
                        <i class="fas fa-times"></i> Fermer
                    </button>
                </div>
            `;
        }
    }
}

function addModalEventListeners() {
    // Image thumbnail click events for image carousel
    document.querySelectorAll('.thumbnail').forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            const index = this.getAttribute('data-index');
            const mainImage = document.getElementById('main-modal-image');
            if (mainImage) {
                mainImage.src = currentProductImages[index];
                
                // Update active thumbnail
                document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            }
        });
    });
    
    // Size selection events
    document.querySelectorAll('.size-option-modal').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.size-option-modal').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
        });
    });
    
    // Quantity control events
    let quantity = 1;
    const quantityDisplay = document.getElementById('quantity-display-modal');
    const decreaseBtn = document.getElementById('decrease-quantity-modal');
    const increaseBtn = document.getElementById('increase-quantity-modal');
    const addToCartBtn = document.getElementById('add-to-cart-modal');
    
    if (decreaseBtn && quantityDisplay) {
        decreaseBtn.addEventListener('click', function() {
            if (quantity > 1) {
                quantity--;
                quantityDisplay.textContent = quantity;
            }
        });
    }
    
    if (increaseBtn && quantityDisplay) {
        increaseBtn.addEventListener('click', function() {
            quantity++;
            quantityDisplay.textContent = quantity;
        });
    }
    
    // Add to cart from modal
    if (addToCartBtn) {
        addToCartBtn.addEventListener('click', async function() {
            const selectedSize = document.querySelector('.size-option-modal.selected')?.getAttribute('data-size') || currentProductSizes[0] || '50ml';
            
            // Check if product is out of stock
            const doc = await db.collection('products').doc(currentProductId).get();
            if (doc.exists) {
                const product = doc.data();
                const stockStatuses = getProductStockStatuses(product);
                if (stockStatuses.includes('rupture de stock')) {
                    showNotification('Ce produit est en rupture de stock', 'error');
                    return;
                }
                
                try {
                    // Add to cart with selected quantity and size
                    const existingItem = cart.find(item => item.id === currentProductId && item.size === selectedSize);
                    
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        cart.push({
                            id: currentProductId,
                            name: product.name,
                            price: parseFloat(product.price),
                            imageUrl: currentProductImages[0],
                            quantity: quantity,
                            size: selectedSize,
                            volume: selectedSize,
                            brand: product.brand || ''
                        });
                    }
                    
                    saveCartToStorage();
                    updateCartUI();
                    
                    // Show notification
                    showNotification(`${product.name} (${selectedSize}) ajout√© au panier!`, 'success');
                    
                    // Close modal
                    if (productModalOverlay) productModalOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                    
                } catch (error) {
                    console.error('Error adding to cart from modal:', error);
                    showNotification('Erreur lors de l\'ajout au panier', 'error');
                }
            }
        });
    }
}

// ========== NOTIFICATION FUNCTION ==========
function showNotification(message, type = 'success') {
    // Remove existing notification
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}
   </script>
</body>
</html>





